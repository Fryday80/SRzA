<?php
$title = 'Edit Menu';
// $this->headLink()->prependStylesheet('/js/jstree/themes/default-dark/style.css');
$this->headScript()->appendFile('/js/jquery.nestable.js');
// $this->headScript()->appendFile('/js/jstree/jstree.min.js');
$this->headTitle($title);
?>
<h1><?php echo $this->escapeHtml($title); ?></h1>


<input id="save-menu" type="button" value="Save Sorting"></input>
<input id="add-menu-item" type="button" value="Add Item"></input>
<div id="success">Erfolg</div>
<div>
<div id="error">Fehler</div>
<div id="navTree" class="dd">
</div>
    <br>
	<?php echo $this->render('navTreeEdit.phtml'); ?>
</div>
<script type="text/javascript">

    $(document).ready(function(){
    	$('.dd-list').nestable({});

        function animateError() {
            var origin = $("#error").css("opacity");
            $("#error").css("opacity", "1");
            $("#error").animate({
                "opacity": origin,

            }, 2000, function complete() {

            });
        }
        function animateSave() {
            var origin = $("#success").css("opacity");
            $("#success").css("opacity", "1");
            $("#success").animate({
                "opacity": origin,

            }, 2000, function complete() {

            });
        }

        $('#save-menu').on('click', function() {
        	var data = $('.dd').nestable('serialize');
        	data = JSON.stringify(data);
        	console.log(data);
            $.ajax
            ({
                type: "POST",
                url: '/nav/sort',
                dataType: 'json',
                async: true,
                data: data,
                success: function (e, a) {
					console.log(e, a);
                    animateSave();
                },
                error: function (e, a) {
    				console.log(e.responseText, a);
                    animateError();
                }
            }).done(function( msg ) {
                console.log(msg);
            });
        });
        $('#add-menu-item').on('click', function() {
        	var getUrl = window.location;
        	var url = getUrl.protocol + "//" + getUrl.host + "/nav/add";
        	window.location = url;
        });
        $('.dd-edit').on('click', function(e) {
        	$(this).parent('.dd3-content').toggleClass('dd-expanded');
            //console.log($(this).parent('.dd3-content') );
        });
    });
</script>








