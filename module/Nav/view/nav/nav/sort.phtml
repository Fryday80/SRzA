<?php
$title = 'Edit Menu';
// $this->headLink()->prependStylesheet('/js/jstree/themes/default-dark/style.css');
$this->headScript()->appendFile('/js/nestable/jquery.nestable.js');
// $this->headScript()->appendFile('/js/jstree/jstree.min.js');
$this->headTitle($title);
?>
<h1><?php echo $this->escapeHtml($title); ?></h1>


<input id="save-menu" type="button" value="Save Sorting">
<input id="add-menu-item" type="button" value="Add Item">

<div id="success">Erfolgreich gespeichert</div>
<div id="error">Fehler Ã¤nderungen konten nicht gespeichert werden</div>
<div id="navTree" class="dd">
    <br>
    <?php echo $this->render('navTreeEdit.phtml'); ?>
</div>
<div style="clear: both"></div>


<script type="text/javascript">

    $(document).ready(function(){
    	$('.dd').nestable({});

        function animateResponse(selector) {
            var $elements = [$("#content>.box"),$("#navTree>.dd-list"), ( selector == 'success' ) ? $("#success") : $("#error")];
            var background = ( selector == 'success' ) ? "green" : "red";
            var origin_bg = [];
            var origin_op = [];

            jQuery.each($elements, function (index, $value){
                origin_bg[index] = $value.css("background-color");
                origin_op[index] = $value.css("opacity")?$value.css("opacity"):"1";
                $value.css("background-color", background)
                    .css("opacity", "1");
                $value.animate({
                        "opacity": origin_op[index],
                        "background-color": origin_bg[index]
                    },
                    2000,
                    function complete() {}
                )
            });
        }

        $('#save-menu').on('click', function() {
        	var data = $('.dd').nestable('serialize');
        	data = JSON.stringify(data);
        	console.log(data);
            $.ajax
            ({
                type: "POST",
                url: '/nav/sort',
                dataType: 'json',
                async: true,
                data: data,
                success: function (e, a) {
					console.log(e, a);
                    animateResponse('success');
                },
                error: function (e, a) {
    				console.log(e.responseText, a);
                    animateResponse('error');
                }
            }).done(function( msg ) {
                console.log(msg);
            });
        });
        $('#add-menu-item').on('click', function() {
        	var getUrl = window.location;
        	var url = getUrl.protocol + "//" + getUrl.host + "/nav/add";
        	window.location = url;
        });
        $('.dd-edit').on('click', function(e) {
        	$(this).parent('.dd3-content').toggleClass('dd-expanded');
            //console.log($(this).parent('.dd3-content') );
        });
    });
</script>








