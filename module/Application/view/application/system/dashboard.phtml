<style>
    /* pannels */
    div box.systemPanel,
    div box.cachePanel
    {
        width: 45%;
        float: left !important;
        margin-right: 5%;
    }
</style>

<?php
$title = 'Dashboard';
    $this->headTitle($title);

echo '<h1>' . $this->escapeHtml($title) . '</h1>';
?>
<?php echo $this->inlineFromFile('Application', 'system', 'dashboard.css'); ?>
<div>
    <box class="dashboard systemPanel">
        <boxtitle class="system">
            <span class="own_text_small">System</span>
        </boxtitle>
        <boxcontent>
            <ul>
                <?php
                $selector = '';
                    foreach ($systemConfig as $key => $item):
                        switch ($item['type']){
                            case 'function':
                                //buttom
                                $selector = '<button class="' . $item['type'] . '">-->Go</button>';
                                break;
                            case 'boolean':
                                //checkbox
                                $selector = '<input type="checkbox" name="' . $key . '" data-configkey="' . $item['type'] . '"><button class="' . $item['type'] . '">-->Go</button>';
                                break;
                            case 'string':
                                //input
                                $selector = '<input type="text" name="' . $key . '" data-configkey="' . $item['type'] . '"><button class="' . $item['type'] . '">-->Go</button>';
                                break;
                            case 'number':
//                                input type number
                                $selector = '<input type="number" name="' . $key . '" data-configkey="' . $item['type'] . '"><button class="' . $item['type'] . '">-->Go</button>';
                                break;
                            default:
                        }
                ?>
                        <li>
                            <?php echo $key .', ' . $selector; ?>
                        </li>
                <?php
                    endforeach;
                ?>
            </ul>
        </boxcontent>
    </box>
    <box class="dashboard cachePanel">
        <boxtitle class="cache">
            <span class="own_text_small">Cache</span>
        </boxtitle>
        <boxcontent>
            <ul>
                <?php
                    function createCacheList($data) {
                        $return = '';
                        foreach ($data as $item) {
                            $name = $item['name'];
                            $return .= '<li>';
                            //                        $return .= 'test';
                            $return .= $name . ', Size: ' . $item['size'] . ' <button class="clearCache ' . $name . '">Clear ' . $name . ' Cache</button>';
                            if (isset($item['childes'][0])) {
                                $return .= '<ul>';
                                $return .= createCacheList($item['childes']);
                                $return .= '</ul>';
                            }
                            $return .= '</li>';
                        }
                        return $return;
                    }
                echo createCacheList($cacheList);
                ?>
            </ul>
        </boxcontent>
    </box>
</div>
<div class="clear"></div>
<div>
<?php
// ************************************************************************************* QUICK LINKS
?>
<box class = 'dashboard'>
    <boxtitle>
        <span class='own_text_small'></span>
    </boxtitle>
    <boxcontent>
        <ul class="dash-links">
            <li><a href='/'><b>Home</b></a></li>
            <li><a href='/cms'><b>Content</b></a></li>
            <li><a href='/media/filebrowser'><b>BrowserFile</b></a></li>
            <li><a href='/nav/sort'><b>Navigation</b></a></li>
            <li><a href='/system/dashboard'><b>Dashboard Reload</b></a></li>
        </ul></boxcontent>
</box>

<?php
// ************************************************************************************* USER STATS
$li = '';
if($userStats !== null) {
    foreach ($userStats as $item)
        if ($item !== null)
            foreach ($item as $k => $v) {
                $li .= "<li><p><b>$k:</b></p>$v</li>";
                // save all clicks value for Top10 in $allClicks
                if ($k == 'Alle Clicks') $allClicks = $v;
            }
}
else {
    $li =  "<li>no stats found</li>";
}
?>
<box class = 'user-stats'>
    <boxtitle>
        <span class='own_text_small'>User Statistics</span>
    </boxtitle>
    <boxcontent>
        <ul class="dash-list">
            <?php echo $li ?>
        </ul>
    </boxcontent>
</box>

<?php
// ************************************************************************************* LIVE CLICKS
// made in js
?>
<box class = 'dashboard'>
    <boxtitle>
        <span class='own_text_small'>Live Clicks</span>
    </boxtitle>
    <boxcontent>
        <img class="live-load" src="/img/loading.gif"/>
        <ul id="dashLiveList" class="dash-list">
            <li class="entry basicdata" data-timestamp="0"></li>
        </ul>
    </boxcontent>
</box>

<?php
// ************************************************************************************* ACTIVE USERS
// made in js
?>
<box class = 'dashboard'>
    <boxtitle>
        <span class='own_text_small'>Active Users</span>
    </boxtitle>
    <boxcontent>
        <img class="user-load" src="/img/loading.gif"/>
        <ul id="users" class="dash-list">
            <li class="entry basicdata" data-timestamp="0"></li>
        </ul>
    </boxcontent>
</box>

<?php
// ************************************************************************************* SYSTEM LOG
$li = '';
if($sysLog !== null) {
    foreach ($sysLog as $item)
        if ($item !== null)
            $li .= '<li>' . date('d.m.y H:i',$item->time) . ' &nbsp;&nbsp;' . $item->msg . ' &nbsp;&nbsp;at ' . $item->url . '</li>';
} else {
    $li = '<li>no log found</li>';
}
?>
<box class = 'dashboard systemLog'>
    <boxtitle>
        <span class='own_text_small'>System Log</span>
    </boxtitle>
    <boxcontent>
        <ul class="dash-list">
            <?php echo $li ?>
        </ul>
    </boxcontent>
</box>
 <?php   
// ************************************************************************************** Top 10 Sites
 if ($top10 !== null):
     $li = '';
     $summedHits = 0;
     $c = 0;
     $maxHitsCountLength = (isset($top10[0]))?strlen($top10[0]->hitsSum):1;
     foreach ($top10 as $item){
         if ($item !== null){
             $c++;
             $li .= "<li><b>"
                 . sprintf("%'.02d.\n", $c) . "&nbsp;&nbsp;&nbsp; ".sprintf("%'.0".$maxHitsCountLength."d\n", $item->hitsSum) 
                 . "</b> &nbsp;&nbsp;&nbsp; hits on &nbsp;&nbsp;&nbsp;<b> ." .$item->url
                 ."</b></li>";
             $summedHits = $summedHits + $item->hitsSum;
         }
     }
     // first line <li> of top 10 summarizes result parts
     $pre = '<li> => <b>' . $summedHits . "</b> Hits of <b>" . $allClicks . "</b> Hits on <b>" . $c ."</b> sites</li>";
     $pre .= '<li>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</li>';
     $li = $pre.$li;
 ?>
<box class = 'dashboard'>
    <boxtitle>
        <span class='own_text_small'>Seiten Top 10</span>
    </boxtitle>
    <boxcontent>
        <ul class="dash-list" style="max-height: none">
            <?php echo $li ?>
        </ul>
    </boxcontent>
</box>
    <?php
    endif;
    ?>
</div>
<div id="sysTable" class="hidden">
<!--    --><?php //echo $this->dataTable()->render($sysLogTable); ?>
</div>
<?php echo $this->inlineFromFile('Application', 'system', 'dashboard.js'); ?>