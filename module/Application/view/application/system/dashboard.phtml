<?php

$title = 'Dashboard';
    $this->headTitle($title);

echo '<h1>' . $this->escapeHtml($title) . '</h1>';
?>
<?php echo $this->inlineFromFile('Application', 'system', 'dashboard.css'); ?>
<div>
<?php
// ************************************************************************************* QUICK LINKS
?>
<box class = 'dashboard'>
    <boxtitel>
        <span class='own_text_small'></span>
    </boxtitel>
    <boxcontent>
        <ul class="dash-links">
            <li><a href='/'><b>Home</b></a></li>
            <li><a href='/cms'><b>Content</b></a></li>
            <li><a href='/media/filebrowser'><b>BrowserFile</b></a></li>
            <li><a href='/nav/sort'><b>Navigation</b></a></li>
            <li><a href='/system/dashboard'><b>Dashboard Reload</b></a></li>
        </ul></boxcontent>
</box>

<?php
// ************************************************************************************* USER STATS
$li = '';
if($userStats !== null) {
    foreach ($userStats as $item)
        if ($item !== null)
            foreach ($item as $k => $v) {
                $li .= "<li><p><b>$k:</b></p>$v</li>";
                if ($k == 'All Clicks') $allClicks = $v;
            }
}
else {
    $li =  "<li>no stats found</li>";
}
?>
<box class = 'user-stats'>
    <boxtitel>
        <span class='own_text_small'>User Statistics</span>
    </boxtitel>
    <boxcontent>
        <ul class="dash-list">
            <?php echo $li ?>
        </ul>
    </boxcontent>
</box>

<?php
// ************************************************************************************* LIVE CLICKS
// made in js
?>
<box class = 'dashboard'>
    <boxtitel>
        <span class='own_text_small'>Live Clicks</span>
    </boxtitel>
    <boxcontent>
        <img class="live-load" src="/img/loading.gif"/>
        <ul id="dashLiveList" class="dash-list">
            <li class="entry basicdata" data-timestamp="0"></li>
        </ul>
    </boxcontent>
</box>

<?php
// ************************************************************************************* ACTIVE USERS
// made in js
?>
<box class = 'dashboard'>
    <boxtitel>
        <span class='own_text_small'>Active Users</span>
    </boxtitel>
    <boxcontent>
        <img class="user-load" src="/img/loading.gif"/>
        <ul id="users" class="dash-list">
            <li class="entry basicdata" data-timestamp="0"></li>
        </ul>
    </boxcontent>
</box>

<?php
// ************************************************************************************* SYSTEM LOG
$li = '';
if($sysLog !== null) {
    foreach ($sysLog as $item)
        if ($item !== null)
            $li .= '<li>' . date('d.m.y H:i',$item->time) . ' ' . $item->msg . ' at ' . $item->url . '</li>';
} else {
    $li = '<li>no log found</li>';
}
?>
<box class = 'dashboard'>
    <boxtitel>
        <span class='own_text_small'>System Log</span>
    </boxtitel>
    <boxcontent>
        <ul class="dash-list">
            <?php echo $li ?>
        </ul>
    </boxcontent>
</box>
 <?php   
// ************************************************************************************** Top 10 Sites
 if ($top10 !== null):
     $li = '';
     $summedHits = 0;
     $c = 0;
     $maxHitsCountLength = (isset($top10[0]))?strlen($top10[0]->hitsSum):1;
     foreach ($top10 as $item){
         if ($item !== null){
             $c++;
             $li .= "<li><b>". sprintf("%'.02d.\n", $c) . "&nbsp;&nbsp;&nbsp; ".sprintf("%'.0".$maxHitsCountLength."d\n", $item->hitsSum) ."</b> &nbsp;&nbsp;&nbsp; hits on &nbsp;&nbsp;&nbsp;<b> ." .$item->url ."</b></li>";
             $summedHits = $summedHits + $item->hitsSum;
         }
     }
     $pre = '<li> => <b>' . $summedHits . "</b> Hits of <b>" . $allClicks . "</b> Hits on <b>" . $c ."</b> sites</li>";
     $li = $pre.$li;
 ?>
<box class = 'dashboard'>
    <boxtitel>
        <span class='own_text_small'>Seiten Top 10</span>
    </boxtitel>
    <boxcontent>
        <ul class="dash-list" style="max-height: none">
            <?php echo $li ?>
        </ul>
    </boxcontent>
</box>
    <?php
    endif;
    ?>
</div>
<?php echo $this->inlineFromFile('Application', 'system', 'dashboard.js'); ?>
